# 工作流按钮菜单配置指南

## 📋 需要配置的菜单地址

### 1. 现有菜单（已存在，无需创建）
```
系统管理 → 在线开发 → 自定义按钮
菜单地址：/online/cgform/button
```
这个菜单已经存在，就是您截图中看到的界面，我们将扩展它支持工作流功能。

### 2. 新增菜单配置

#### A. 在现有菜单结构中添加：

```sql
-- 在 sys_permission 表中插入新菜单
INSERT INTO sys_permission (
    id, parent_id, name, url, component, component_name, redirect, menu_type, 
    perms, perms_type, sort_no, always_show, icon, is_route, is_leaf, keep_alive, 
    hidden, hide_tab, description, status, del_flag, rule_flag, create_by, 
    create_time, update_by, update_time, internal_or_external
) VALUES (
    'workflow_button_config', 
    '现有父菜单ID', 
    '工作流按钮配置', 
    '/workflow/button/config', 
    'workflow/buttonConfig/index', 
    'WorkflowButtonConfig', 
    NULL, 
    1, 
    NULL, 
    '1', 
    1.0, 
    0, 
    'ant-design:setting-outlined', 
    1, 
    1, 
    0, 
    0, 
    0, 
    '工作流按钮配置管理', 
    '1', 
    0, 
    0, 
    'admin', 
    NOW(), 
    NULL, 
    NULL, 
    0
);
```

#### B. 或者使用现有菜单，无需额外配置

**推荐方式：直接使用现有的"自定义按钮"菜单**
- 菜单路径：`系统管理 → 在线开发 → 自定义按钮`
- 访问地址：`http://你的域名/online/cgform/button`

## 🎯 使用方法

### 1. **配置工作流按钮（3步完成）**

#### 步骤1：执行数据库脚本
```bash
# 执行扩展脚本，添加工作流按钮
mysql -u用户名 -p密码 数据库名 < jeecg-boot/db/workflow_buttons_extension.sql
```

#### 步骤2：访问现有按钮管理
```
进入：系统管理 → 在线开发 → 自定义按钮
选择：您的表单
```

#### 步骤3：为表单启用工作流按钮
在按钮列表中，您会看到新增的工作流按钮：
- `save_draft` (保存草稿)
- `submit_review` (提交审核)  
- `approve` (审核通过)
- `reject` (审核拒绝)
- `transfer` (转办)
- `go_back` (退回)
- 等等...

只需要**激活**需要的按钮即可！

### 2. **在表单中使用**

#### 方式A：使用SmartButtonGroup组件
```vue
<template>
  <div>
    <!-- 原有表单内容 -->
    <OnlineForm :form-config="formConfig" :form-data="formData" />
    
    <!-- 工作流按钮组（会自动读取配置的按钮） -->
    <SmartButtonGroup 
      :form-id="formId" 
      :data-id="dataId" 
      :task-id="taskId"
      @save="handleSave"
      @submit="handleSubmit"
      @approve="handleApprove"
      @reject="handleReject"
    />
  </div>
</template>

<script setup>
import SmartButtonGroup from '@/views/workflow/components/SmartButtonGroup.vue';
// 其他代码...
</script>
```

#### 方式B：直接使用现有的OnlineForm（推荐）
```vue
<template>
  <!-- OnlineForm会自动处理按钮显示，无需额外组件 -->
  <OnlineForm 
    :id="formId" 
    :data-id="dataId"
    :task-id="taskId"
  />
</template>
```

### 3. **按钮配置示例**

#### 基础工作流表单配置：
1. 进入：`自定义按钮管理`
2. 选择您的表单
3. 激活以下按钮：
   ```
   ✅ save_draft (保存草稿)
   ✅ submit_review (提交审核)
   ✅ approve (审核通过) 
   ✅ reject (审核拒绝)
   ```

#### 高级工作流表单配置：
```
✅ save_draft (保存草稿)
✅ submit_review (提交审核)
✅ approve (审核通过)
✅ reject (审核拒绝)
✅ transfer (转办)
✅ go_back (退回)
✅ delegate (委派)
✅ suspend (挂起)
```

## 🔧 高级配置

### 1. **按钮显示条件**
在按钮编辑时，可以设置显示条件：
```javascript
// 只在草稿状态显示
status == "DRAFT"

// 只有审批权限的用户显示
hasPermission("approve")

// 组合条件
status == "PROCESSING" && hasPermission("approve")
```

### 2. **按钮权限配置**
为按钮设置权限编码：
```
workflow:approve    // 审批权限
workflow:reject     // 拒绝权限
workflow:transfer   // 转办权限
```

### 3. **确认消息配置**
为按钮设置确认提示：
```
确定要提交审核吗？提交后将无法修改
确定审核通过吗？
确定要拒绝吗？请填写拒绝理由
```

## 🎉 优势总结

### ✅ **超简单**
- 无需学习新界面，使用现有的按钮管理
- 无需复杂配置，激活按钮即可
- 无需编写代码，开箱即用

### ✅ **完全兼容**
- 基于现有 `onl_cgform_button` 表扩展
- 不影响现有功能
- 与现有按钮系统无缝集成

### ✅ **功能强大**
- 支持所有工作流场景
- 支持权限控制
- 支持条件显示
- 支持确认消息

### ✅ **易维护**
- 统一的管理界面
- 统一的数据结构
- 统一的权限体系

## 🚀 立即开始

1. **执行数据库脚本**：`workflow_buttons_extension.sql`
2. **访问按钮管理**：`系统管理 → 在线开发 → 自定义按钮`
3. **激活工作流按钮**：选择需要的按钮并激活
4. **在表单中使用**：直接使用 `OnlineForm` 组件

就这么简单！🎯