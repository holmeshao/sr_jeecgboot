<!--
ğŸ¯ JeecgBootå­—æ®µæƒé™é…ç½®å¼¹çª—æ¨¡æ¿
åœ¨Flowableè®¾è®¡å™¨ä¸­æä¾›å¯è§†åŒ–çš„å­—æ®µæƒé™é…ç½®ç•Œé¢
-->

<div class="modal-content jeecg-field-permission-modal">
    <!-- æ¨¡æ€æ¡†å¤´éƒ¨ -->
    <div class="modal-header">
        <h4 class="modal-title">
            <i class="glyphicon glyphicon-lock"></i>
            å­—æ®µæƒé™é…ç½®
            <small>{{ selectedFormKey }}</small>
        </h4>
        <button type="button" class="close" ng-click="closePermissionPanel()">
            <span>&times;</span>
        </button>
    </div>
    
    <!-- æ¨¡æ€æ¡†å†…å®¹ -->
    <div class="modal-body">
        
        <!-- åŠ è½½çŠ¶æ€ -->
        <div ng-if="loadingFields" class="text-center">
            <i class="fa fa-spinner fa-spin"></i> æ­£åœ¨åŠ è½½è¡¨å•å­—æ®µ...
        </div>
        
        <!-- è¡¨å•å­—æ®µæœªåŠ è½½ -->
        <div ng-if="!formFieldsLoaded && !loadingFields" class="alert alert-info">
            <i class="fa fa-info-circle"></i>
            è¯·ç­‰å¾…è¡¨å•å­—æ®µåŠ è½½å®Œæˆï¼Œæˆ–æ£€æŸ¥è¡¨å•Keyæ˜¯å¦æ­£ç¡®é…ç½®ã€‚
        </div>
        
        <!-- å­—æ®µæƒé™é…ç½®ä¸»ç•Œé¢ -->
        <div ng-if="formFieldsLoaded && !loadingFields">
            
            <!-- æ“ä½œå·¥å…·æ  -->
            <div class="permission-toolbar">
                <div class="row">
                    <div class="col-md-8">
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-default" ng-click="applySmartDefaults()">
                                <i class="fa fa-magic"></i> æ™ºèƒ½é»˜è®¤
                            </button>
                            <button type="button" class="btn btn-default" ng-click="batchSetPermission('editable')">
                                <i class="fa fa-edit"></i> å…¨éƒ¨å¯ç¼–è¾‘
                            </button>
                            <button type="button" class="btn btn-default" ng-click="batchSetPermission('readonly')">
                                <i class="fa fa-eye"></i> å…¨éƒ¨åªè¯»
                            </button>
                            <button type="button" class="btn btn-default" ng-click="batchSetPermission('hidden')">
                                <i class="fa fa-eye-slash"></i> å…¨éƒ¨éšè—
                            </button>
                        </div>
                    </div>
                    <div class="col-md-4 text-right">
                        <small class="text-muted">
                            å…± {{ formFields.length }} ä¸ªå­—æ®µ
                        </small>
                    </div>
                </div>
            </div>
            
            <!-- æƒé™é…ç½®æ‘˜è¦ -->
            <div class="permission-summary alert alert-success">
                <strong>æƒé™æ‘˜è¦ï¼š</strong> {{ getPermissionSummary() }}
            </div>
            
            <!-- å­—æ®µæƒé™é…ç½®è¡¨æ ¼ -->
            <div class="field-permission-table">
                <table class="table table-bordered table-hover table-condensed">
                    <thead>
                        <tr class="info">
                            <th width="25%">å­—æ®µåç§°</th>
                            <th width="15%">å­—æ®µç±»å‹</th>
                            <th width="15%">å­—æ®µåˆ†ç±»</th>
                            <th width="20%">æƒé™è®¾ç½®</th>
                            <th width="10%">å¿…å¡«</th>
                            <th width="15%">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="field in formFields track by field.fieldName" 
                            ng-class="{'warning': field.permission === 'editable', 'info': field.permission === 'readonly', 'danger': field.permission === 'hidden'}">
                            
                            <!-- å­—æ®µåç§° -->
                            <td>
                                <strong>{{ field.fieldLabel || field.fieldName }}</strong>
                                <br>
                                <small class="text-muted">{{ field.fieldName }}</small>
                            </td>
                            
                            <!-- å­—æ®µç±»å‹ -->
                            <td>
                                <span class="label label-default">{{ field.fieldType }}</span>
                            </td>
                            
                            <!-- å­—æ®µåˆ†ç±» -->
                            <td>
                                <span class="label" ng-class="{
                                    'label-primary': field.category === 'business',
                                    'label-success': field.category === 'workflow', 
                                    'label-warning': field.category === 'system',
                                    'label-info': field.category === 'file'
                                }">
                                    {{ getCategoryText(field.category) }}
                                </span>
                            </td>
                            
                            <!-- æƒé™è®¾ç½® -->
                            <td>
                                <select class="form-control input-sm" 
                                        ng-model="field.permission" 
                                        ng-change="onFieldPermissionChange(field)"
                                        ng-disabled="field.category === 'system'">
                                    <option value="editable">ğŸ–Šï¸ å¯ç¼–è¾‘</option>
                                    <option value="readonly">ğŸ‘ï¸ åªè¯»</option>
                                    <option value="hidden">ğŸš« éšè—</option>
                                </select>
                            </td>
                            
                            <!-- å¿…å¡«è®¾ç½® -->
                            <td class="text-center">
                                <input type="checkbox" 
                                       ng-model="field.required" 
                                       ng-change="onFieldRequiredChange(field)"
                                       ng-disabled="field.permission === 'hidden' || field.category === 'system'">
                            </td>
                            
                            <!-- æ“ä½œ -->
                            <td class="text-center">
                                <div class="btn-group btn-group-xs" role="group">
                                    <button type="button" 
                                            class="btn btn-success btn-xs" 
                                            ng-click="field.permission='editable'; onFieldPermissionChange(field)"
                                            ng-disabled="field.category === 'system'"
                                            title="è®¾ä¸ºå¯ç¼–è¾‘">
                                        <i class="fa fa-edit"></i>
                                    </button>
                                    <button type="button" 
                                            class="btn btn-info btn-xs" 
                                            ng-click="field.permission='readonly'; onFieldPermissionChange(field)"
                                            title="è®¾ä¸ºåªè¯»">
                                        <i class="fa fa-eye"></i>
                                    </button>
                                    <button type="button" 
                                            class="btn btn-danger btn-xs" 
                                            ng-click="field.permission='hidden'; onFieldPermissionChange(field)"
                                            ng-disabled="field.category === 'system'"
                                            title="è®¾ä¸ºéšè—">
                                        <i class="fa fa-eye-slash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- ç©ºçŠ¶æ€ -->
            <div ng-if="formFields.length === 0" class="text-center text-muted">
                <i class="fa fa-inbox fa-3x"></i>
                <p>æœªæ‰¾åˆ°è¡¨å•å­—æ®µ</p>
            </div>
        </div>
    </div>
    
    <!-- æ¨¡æ€æ¡†åº•éƒ¨ -->
    <div class="modal-footer">
        <div class="row">
            <div class="col-md-6 text-left">
                <!-- æƒé™é¢„è§ˆ -->
                <div ng-if="formFieldsLoaded" class="permission-preview">
                    <small class="text-muted">
                        <i class="fa fa-info-circle"></i>
                        é…ç½®å®Œæˆåå°†è‡ªåŠ¨åº”ç”¨åˆ°æµç¨‹èŠ‚ç‚¹
                    </small>
                </div>
            </div>
            <div class="col-md-6 text-right">
                <button type="button" class="btn btn-default" ng-click="closePermissionPanel()">
                    <i class="fa fa-times"></i> å–æ¶ˆ
                </button>
                <button type="button" 
                        class="btn btn-primary" 
                        ng-click="saveFieldPermissions()"
                        ng-disabled="!formFieldsLoaded">
                    <i class="fa fa-save"></i> ä¿å­˜é…ç½®
                </button>
            </div>
        </div>
    </div>
</div>

<!-- è‡ªå®šä¹‰æ ·å¼ -->
<style>
.jeecg-field-permission-modal {
    width: 800px;
    max-width: 90vw;
}

.permission-toolbar {
    margin-bottom: 15px;
    padding: 10px;
    background-color: #f8f9fa;
    border-radius: 4px;
}

.permission-summary {
    margin-bottom: 15px;
    font-size: 13px;
}

.field-permission-table {
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.field-permission-table table {
    margin-bottom: 0;
}

.field-permission-table th {
    background-color: #f5f5f5;
    position: sticky;
    top: 0;
    z-index: 10;
}

.field-permission-table td {
    vertical-align: middle !important;
}

.permission-preview {
    padding: 5px 0;
}

/* æƒé™çŠ¶æ€è¡Œæ ·å¼ */
.field-permission-table tr.warning {
    background-color: #fcf8e3 !important;
}

.field-permission-table tr.info {
    background-color: #d9edf7 !important;
}

.field-permission-table tr.danger {
    background-color: #f2dede !important;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
    .jeecg-field-permission-modal {
        width: 95vw;
    }
    
    .permission-toolbar .btn-group {
        width: 100%;
    }
    
    .permission-toolbar .btn {
        font-size: 11px;
        padding: 2px 6px;
    }
    
    .field-permission-table {
        font-size: 12px;
    }
}

/* åŠ è½½åŠ¨ç”» */
.fa-spin {
    animation: fa-spin 2s infinite linear;
}

@keyframes fa-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>