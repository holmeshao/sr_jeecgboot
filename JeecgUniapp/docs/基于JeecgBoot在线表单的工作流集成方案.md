# JeecgBootåœ¨çº¿è¡¨å•å·¥ä½œæµé›†æˆæ–¹æ¡ˆï¼ˆæœ€ç»ˆç‰ˆv3.0ï¼‰

## 1. è®¾è®¡ç†å¿µä¸æ ¸å¿ƒåŸåˆ™

### 1.1 è®¾è®¡ç†å¿µ
ç»è¿‡æ·±å…¥è®¨è®ºå’Œå®è·µéªŒè¯ï¼Œæˆ‘ä»¬ç¡®å®šäº†ä»¥ä¸‹æ ¸å¿ƒç†å¿µï¼š

1. **ç®€å•ä¼˜å…ˆ**ï¼šä¼˜å…ˆé‡‡ç”¨ç®€å•æœ‰æ•ˆçš„ä¼ ç»Ÿæ–¹æ¡ˆï¼Œé¿å…è¿‡åº¦è®¾è®¡
2. **åˆ†ç¦»è§£è€¦**ï¼šè¡¨å•ä¸å·¥ä½œæµé€‚åº¦åˆ†ç¦»ï¼Œä¿æŒå„è‡ªç‹¬ç«‹æ€§
3. **é…ç½®é©±åŠ¨**ï¼šé€šè¿‡é…ç½®å®ç°å¤æ‚åŠŸèƒ½ï¼Œå‡å°‘ç¡¬ç¼–ç 
4. **æŒ‰éœ€å¯ç”¨**ï¼šé«˜çº§åŠŸèƒ½é€šè¿‡å¼€å…³æ§åˆ¶ï¼Œæ¸è¿›å¼ä½¿ç”¨
5. **ä¸€ä½“åŒ–é…ç½®**ï¼šæµç¨‹è®¾è®¡+æƒé™é…ç½®ä¸€æ¬¡å®Œæˆï¼Œæ™ºèƒ½é»˜è®¤

### 1.2 æ ¸å¿ƒæ¶æ„åŸåˆ™
```
ğŸ¯ è¡¨å• + å·¥ä½œæµåˆ†ç¦»é›†æˆæ¶æ„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JeecgBoot      â”‚    â”‚  Flowable        â”‚
â”‚  åœ¨çº¿è¡¨å•       â”‚â—„â”€â”€â–ºâ”‚  å·¥ä½œæµå¼•æ“      â”‚
â”‚  (ä¸šåŠ¡æ•°æ®)     â”‚    â”‚  (æµç¨‹æ§åˆ¶)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²                        â–²
         â”‚                        â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      é…ç½®åŒ–é›†æˆå±‚               â”‚
    â”‚  â€¢ æƒé™é…ç½®                     â”‚
    â”‚  â€¢ æ˜ å°„å…³ç³»                     â”‚
    â”‚  â€¢ ç‰ˆæœ¬æ§åˆ¶                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 ç°æœ‰åŸºç¡€ä¼˜åŠ¿
âœ… **JeecgBootåœ¨çº¿è¡¨å•**ï¼šæˆç†Ÿçš„å…ƒæ•°æ®é©±åŠ¨è¡¨å•ç³»ç»Ÿ
âœ… **Flowableé›†æˆ**ï¼šå·²æœ‰åŸºç¡€çš„å·¥ä½œæµé›†æˆèƒ½åŠ›
âœ… **é¢„ç•™å­—æ®µ**ï¼š`bmp_status`ç­‰å·¥ä½œæµçŠ¶æ€å­—æ®µ
âœ… **æ‰©å±•æœºåˆ¶**ï¼šJSå¢å¼ºå’ŒSQLå¢å¼ºæ”¯æŒå®šåˆ¶åŒ–

## 2. æ ¸å¿ƒæŠ€æœ¯æ–¹æ¡ˆ

### 2.1 ä¼ ç»Ÿåˆ†ç¦»å¼é›†æˆï¼ˆæ ¸å¿ƒæ–¹æ¡ˆï¼‰

**è®¾è®¡æ€è·¯ï¼šè¡¨å•è´Ÿè´£æ•°æ®ï¼Œå·¥ä½œæµè´Ÿè´£æµç¨‹ï¼Œé€šè¿‡æœ€å°‘çš„å­—æ®µè¿›è¡Œå…³è”**

#### 2.1.1 ä¸šåŠ¡è¡¨å•è®¾è®¡ï¼ˆç‰©ç†è¡¨æ¨¡å¼ï¼‰
```sql
-- ä»¥ç»´ä¿å·¥å•ä¸ºä¾‹
CREATE TABLE `maintenance_report` (
  `id` varchar(32) PRIMARY KEY,
  `report_no` varchar(50) NOT NULL,
  `title` varchar(200) NOT NULL,
  `description` text,
  `urgency_level` int DEFAULT 1,
  `project_id` varchar(32),
  
  -- æœ€å°åŒ–å·¥ä½œæµé›†æˆå­—æ®µï¼ˆæ ¸å¿ƒè®¾è®¡ï¼‰
  `process_instance_id` varchar(64) COMMENT 'Flowableæµç¨‹å®ä¾‹ID',
  `bmp_status` varchar(20) DEFAULT 'DRAFT' COMMENT 'ä¸šåŠ¡çŠ¶æ€',
  
  -- æ ‡å‡†å­—æ®µ
  `create_by` varchar(32),
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `update_by` varchar(32),
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  KEY `idx_process_instance` (`process_instance_id`),
  KEY `idx_status` (`bmp_status`)
);
```

#### 2.1.2 è¡¨å•å·¥ä½œæµé…ç½®è¡¨ï¼ˆæ–°å¢ï¼‰
```sql
CREATE TABLE `onl_cgform_workflow_config` (
  `id` varchar(32) NOT NULL,
  `cgform_head_id` varchar(32) NOT NULL COMMENT 'è¡¨å•ID',
  `process_definition_key` varchar(100) NOT NULL COMMENT 'æµç¨‹å®šä¹‰Key',
  
  -- æ ¸å¿ƒé…ç½®å¼€å…³
  `workflow_enabled` tinyint(1) DEFAULT 0 COMMENT 'æ˜¯å¦å¯ç”¨å·¥ä½œæµ',
  `version_control_enabled` tinyint(1) DEFAULT 0 COMMENT 'æ˜¯å¦å¯ç”¨ç‰ˆæœ¬æ§åˆ¶',
  `permission_control_enabled` tinyint(1) DEFAULT 0 COMMENT 'æ˜¯å¦å¯ç”¨æƒé™æ§åˆ¶',
  
  -- æ˜ å°„é…ç½®
  `business_key_field` varchar(50) COMMENT 'ä¸šåŠ¡ä¸»é”®å­—æ®µå',
  `status_field` varchar(50) DEFAULT 'bmp_status' COMMENT 'çŠ¶æ€å­—æ®µå',
  `process_instance_field` varchar(50) DEFAULT 'process_instance_id' COMMENT 'æµç¨‹å®ä¾‹å­—æ®µå',
  
  -- ç‰ˆæœ¬æ§åˆ¶é…ç½®
  `snapshot_strategy` varchar(20) DEFAULT 'NODE' COMMENT 'å¿«ç…§ç­–ç•¥(NODEèŠ‚ç‚¹çº§,TASKä»»åŠ¡çº§)',
  `snapshot_nodes` text COMMENT 'éœ€è¦å¿«ç…§çš„èŠ‚ç‚¹JSONæ•°ç»„',
  
  `status` tinyint(1) DEFAULT 1,
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_form_process` (`cgform_head_id`, `process_definition_key`)
);
```

### 2.2 åŸºäºFlowableå˜é‡çš„ç‰ˆæœ¬æ§åˆ¶ï¼ˆåˆ›æ–°æ–¹æ¡ˆï¼‰

**æ ¸å¿ƒç†å¿µï¼šåˆ©ç”¨Flowableè‡ªèº«çš„æµç¨‹å˜é‡æœºåˆ¶å®ç°è¡¨å•ç‰ˆæœ¬åŒ–ï¼Œæ— éœ€é¢å¤–çš„ç‰ˆæœ¬è¡¨**

#### 2.2.1 ç‰ˆæœ¬æ§åˆ¶å®ç°æœºåˆ¶
```java
// åœ¨æ¯ä¸ªå…³é”®èŠ‚ç‚¹å®Œæˆæ—¶ï¼Œå°†è¡¨å•å¿«ç…§å­˜å‚¨åˆ°æµç¨‹å˜é‡
Map<String, Object> variables = new HashMap<>();

// åˆ›å»ºè¡¨å•å¿«ç…§
FormSnapshot snapshot = new FormSnapshot();
snapshot.setNodeCode("submit_node");
snapshot.setFormData(currentFormData);
snapshot.setTimestamp(System.currentTimeMillis());
snapshot.setOperator(getCurrentUser());
snapshot.setChangedFields(calculateChangedFields());

// å­˜å‚¨åˆ°Flowableæµç¨‹å˜é‡
String snapshotKey = "form_snapshot_" + nodeCode;
runtimeService.setVariable(processInstanceId, snapshotKey, JSON.toJSONString(snapshot));
```

#### 2.2.2 ç‰ˆæœ¬æŸ¥è¯¢å’Œå›æº¯
```java
// æŸ¥è¯¢ç‰ˆæœ¬å†å²
List<HistoricVariableInstance> snapshots = historyService
    .createHistoricVariableInstanceQuery()
    .processInstanceId(processInstanceId)
    .variableNameLike("form_snapshot_%")
    .orderByVariableName().asc()
    .list();

// è·å–æŒ‡å®šèŠ‚ç‚¹å¿«ç…§
String snapshotJson = (String) runtimeService.getVariable(
    processInstanceId, "form_snapshot_submit");
FormSnapshot snapshot = JSON.parseObject(snapshotJson, FormSnapshot.class);
```

### 2.3 Flowableè®¾è®¡å™¨é›†æˆæƒé™é…ç½®ï¼ˆæ ¸å¿ƒåˆ›æ–°ï¼‰

**è®¾è®¡æ€è·¯ï¼šåœ¨æµç¨‹è®¾è®¡æ—¶ç›´æ¥é…ç½®å­—æ®µæƒé™ï¼Œå®ç°ä¸€ä½“åŒ–è®¾è®¡ï¼Œæ™ºèƒ½é»˜è®¤ç­–ç•¥**

#### 2.3.1 Flowable Modeleræ‰©å±•

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- âœ… **ä¸€ç«™å¼é…ç½®**ï¼šæµç¨‹è®¾è®¡+æƒé™é…ç½®ä¸€æ¬¡å®Œæˆ
- âœ… **æ™ºèƒ½é»˜è®¤**ï¼šä¸é…ç½®è‡ªåŠ¨åº”ç”¨åˆç†é»˜è®¤ï¼ˆå‘èµ·äººå¯ç¼–è¾‘ï¼Œå…¶ä»–åªè¯»ï¼‰
- âœ… **é€šç”¨å­—æ®µè¯†åˆ«**ï¼šå®¡æ‰¹æ„è§ç­‰è‡ªåŠ¨è¯†åˆ«ä¸ºå„èŠ‚ç‚¹å¯ç¼–è¾‘
- âœ… **å¯è§†åŒ–ç›´è§‚**ï¼šåœ¨æµç¨‹å›¾ä¸Šç›´æ¥çœ‹åˆ°æƒé™é…ç½®çŠ¶æ€

#### 2.3.2 ç”¨æˆ·ä»»åŠ¡å±æ€§æ‰©å±•

```javascript
// åœ¨Flowable Modelerä¸­ä¸ºç”¨æˆ·ä»»åŠ¡å¢åŠ å­—æ®µæƒé™é…ç½®é¢æ¿
ORYX.Plugins.FieldPermissionPropertyCtrl = ORYX.Plugins.AbstractPropertyCtrl.extend({
    
    // åˆ›å»ºå­—æ®µæƒé™é…ç½®æŒ‰é’®
    createFieldPermissionButton: function() {
        var fieldPermissionButton = new Element('button', {
            'class': 'oryx_fieldpermission_button',
            'title': 'é…ç½®å­—æ®µæƒé™'
        });
        fieldPermissionButton.innerHTML = 'å­—æ®µæƒé™é…ç½®';
        fieldPermissionButton.addEventListener('click', this.openFieldPermissionDialog.bind(this));
        this.node.appendChild(fieldPermissionButton);
    },
    
    // æ‰“å¼€å­—æ®µæƒé™é…ç½®å¯¹è¯æ¡†
    openFieldPermissionDialog: function() {
        var currentElement = this.facade.getSelection()[0];
        var formKey = currentElement.properties['oryx-formkey'] || '';
        
        if (!formKey) {
            alert('è¯·å…ˆé…ç½®è¡¨å•Key');
            return;
        }
        
        // è·å–è¡¨å•å­—æ®µå¹¶åˆ›å»ºé…ç½®UI
        this.getFormFields(formKey).then(fields => {
            this.createFieldPermissionUI(fields, currentElement);
        });
    }
});
```

#### 2.3.3 BPMNæ‰©å±•å±æ€§å®šä¹‰

```xml
<!-- åœ¨BPMNæ¨¡å‹ä¸­å¢åŠ JeecgBootå­—æ®µæƒé™æ‰©å±• -->
<bpmn:userTask id="userTask_review" name="å®¡æ ¸èŠ‚ç‚¹">
    <bpmn:extensionElements>
        <jeecg:fieldPermissions>
            <jeecg:editableFields>["audit_opinion", "audit_result"]</jeecg:editableFields>
            <jeecg:readonlyFields>["apply_title", "apply_content", "apply_amount"]</jeecg:readonlyFields>
            <jeecg:hiddenFields>["internal_notes"]</jeecg:hiddenFields>
            <jeecg:requiredFields>["audit_opinion"]</jeecg:requiredFields>
        </jeecg:fieldPermissions>
    </bpmn:extensionElements>
</bpmn:userTask>
```

#### 2.3.4 æ™ºèƒ½é»˜è®¤æƒé™ç­–ç•¥

```java
@Service
public class DefaultFieldPermissionStrategy {
    
    /**
     * æ™ºèƒ½é»˜è®¤æƒé™ç”Ÿæˆ
     * ä¸é…ç½®æ—¶è‡ªåŠ¨åº”ç”¨ï¼šå‘èµ·äººå¯ç¼–è¾‘ä¸šåŠ¡å­—æ®µï¼Œå…¶ä»–èŠ‚ç‚¹åªè¯»+é€šç”¨å­—æ®µå¯ç¼–è¾‘
     */
    public FormPermissionConfig generateDefaultPermission(String formId, String nodeId) {
        
        List<OnlCgformField> allFields = cgformFieldMapper.selectByFormId(formId);
        List<String> businessFields = new ArrayList<>();  // ä¸šåŠ¡å­—æ®µ
        List<String> commonFields = new ArrayList<>();    // é€šç”¨æµç¨‹å­—æ®µ
        
        // æ™ºèƒ½åˆ†ç±»å­—æ®µ
        for (OnlCgformField field : allFields) {
            if (isCommonProcessField(field.getFieldName(), field.getFieldComment())) {
                commonFields.add(field.getFieldName());  // å®¡æ‰¹æ„è§ã€å¤„ç†è¯´æ˜ç­‰
            } else {
                businessFields.add(field.getFieldName()); // ç”³è¯·å†…å®¹ã€ä¸šåŠ¡æ•°æ®ç­‰
            }
        }
        
        FormPermissionConfig config = new FormPermissionConfig();
        
        if (isStartNode(nodeId)) {
            // å‘èµ·èŠ‚ç‚¹ï¼šä¸šåŠ¡å­—æ®µå¯ç¼–è¾‘
            config.setEditableFields(businessFields);
            config.setReadonlyFields(Collections.emptyList());
        } else {
            // å…¶ä»–èŠ‚ç‚¹ï¼šä¸šåŠ¡å­—æ®µåªè¯»ï¼Œé€šç”¨å­—æ®µå¯ç¼–è¾‘
            config.setEditableFields(commonFields);
            config.setReadonlyFields(businessFields);
        }
        
        return config;
    }
    
    /**
     * æ™ºèƒ½è¯†åˆ«é€šç”¨æµç¨‹å­—æ®µ
     */
    private boolean isCommonProcessField(String fieldName, String comment) {
        // æŒ‰å­—æ®µåè¯†åˆ«ï¼šaudit_*, approve_*, process_*, *_opinion, *_comment, *_remark
        if (fieldName.matches("(audit|approve|process)_.*") || 
            fieldName.matches(".*(opinion|comment|remark)")) {
            return true;
        }
        
        // æŒ‰æ³¨é‡Šè¯†åˆ«ï¼šåŒ…å«"å®¡æ‰¹"ã€"æ„è§"ã€"å¤‡æ³¨"ã€"è¯´æ˜"ã€"å¤„ç†"ç­‰å…³é”®è¯
        if (comment != null) {
            return comment.matches(".*(å®¡æ‰¹|æ„è§|å¤‡æ³¨|è¯´æ˜|å¤„ç†).*");
        }
        
        return false;
    }
}
```

#### 2.3.5 BPMNè§£æä¸åŒæ­¥æœºåˆ¶

```java
@Service
public class BpmnFieldPermissionParser {
    
    /**
     * æµç¨‹éƒ¨ç½²æ—¶è‡ªåŠ¨è§£æå­—æ®µæƒé™é…ç½®å¹¶åŒæ­¥åˆ°æ•°æ®åº“
     */
    @EventListener
    public void handleProcessDeployment(ProcessDeployedEvent event) {
        String processDefinitionId = event.getProcessDefinition().getId();
        String processDefinitionKey = event.getProcessDefinition().getKey();
        
        log.info("å¼€å§‹è§£ææµç¨‹ {} çš„å­—æ®µæƒé™é…ç½®", processDefinitionKey);
        parseAndSaveFieldPermissions(processDefinitionId, processDefinitionKey);
    }
    
    private void parseAndSaveFieldPermissions(String processDefinitionId, String processDefinitionKey) {
        
        // è·å–BPMNæ¨¡å‹
        BpmnModel bpmnModel = repositoryService.getBpmnModel(processDefinitionId);
        Process process = bpmnModel.getMainProcess();
        
        // æŸ¥æ‰¾æ‰€æœ‰ç”¨æˆ·ä»»åŠ¡
        Collection<UserTask> userTasks = process.findFlowElementsOfType(UserTask.class);
        
        for (UserTask userTask : userTasks) {
            
            // è§£æå­—æ®µæƒé™æ‰©å±•å±æ€§
            FieldPermissionConfig permissionConfig = parseFieldPermissionFromUserTask(userTask);
            
            if (permissionConfig != null) {
                // ä¿å­˜åˆ°æ•°æ®åº“
                saveNodePermissionConfig(processDefinitionKey, userTask.getId(), 
                                       userTask.getName(), permissionConfig);
                log.info("å·²ä¿å­˜èŠ‚ç‚¹ {} çš„å­—æ®µæƒé™é…ç½®", userTask.getName());
            } else {
                log.info("èŠ‚ç‚¹ {} æœªé…ç½®å­—æ®µæƒé™ï¼Œå°†ä½¿ç”¨æ™ºèƒ½é»˜è®¤ç­–ç•¥", userTask.getName());
            }
        }
    }
    
    private FieldPermissionConfig parseFieldPermissionFromUserTask(UserTask userTask) {
        
        // è·å– fieldPermissions æ‰©å±•å…ƒç´ 
        List<ExtensionElement> fieldPermissionsElements = userTask.getExtensionElements()
            .get("fieldPermissions");
            
        if (fieldPermissionsElements == null || fieldPermissionsElements.isEmpty()) {
            return null; // ä½¿ç”¨é»˜è®¤é…ç½®
        }
        
        ExtensionElement fieldPermissionsElement = fieldPermissionsElements.get(0);
        FieldPermissionConfig config = new FieldPermissionConfig();
        
        // è§£æå„ç§æƒé™é…ç½®
        parseFieldArray(fieldPermissionsElement, "editableFields", config::setEditableFields);
        parseFieldArray(fieldPermissionsElement, "readonlyFields", config::setReadonlyFields);
        parseFieldArray(fieldPermissionsElement, "hiddenFields", config::setHiddenFields);
        parseFieldArray(fieldPermissionsElement, "requiredFields", config::setRequiredFields);
        
        return config;
    }
    
    private void parseFieldArray(ExtensionElement parent, String elementName, 
                                Consumer<List<String>> setter) {
        List<ExtensionElement> elements = parent.getChildElements().get(elementName);
        if (elements != null && !elements.isEmpty()) {
            String jsonText = elements.get(0).getElementText();
            List<String> fields = JSON.parseArray(jsonText, String.class);
            setter.accept(fields);
        }
    }
}
```

## 3. æ ¸å¿ƒæœåŠ¡å®ç°

### 3.1 ç»Ÿä¸€å·¥ä½œæµè¡¨å•æœåŠ¡
```java
@Service
public class OnlineFormWorkflowService {
    
    @Autowired
    private RuntimeService runtimeService;
    
    @Autowired
    private TaskService taskService;
    
    @Autowired
    private OnlineFormPermissionEngine permissionEngine;
    
    /**
     * å¯åŠ¨è¡¨å•å·¥ä½œæµ
     */
    @Transactional
    public String startFormWorkflow(String formId, String dataId, Map<String, Object> formData) {
        
        // 1. è·å–å·¥ä½œæµé…ç½®
        OnlCgformWorkflowConfig config = getWorkflowConfig(formId);
        if (!config.isWorkflowEnabled()) {
            throw new BusinessException("è¯¥è¡¨å•æœªå¯ç”¨å·¥ä½œæµ");
        }
        
        // 2. æ›´æ–°ä¸šåŠ¡è¡¨çŠ¶æ€
        updateBusinessStatus(formId, dataId, "PROCESSING");
        
        // 3. å¯åŠ¨æµç¨‹
        ProcessInstance instance = runtimeService.startProcessInstanceByKey(
            config.getProcessDefinitionKey(), 
            dataId, 
            formData
        );
        
        // 4. æ›´æ–°æµç¨‹å®ä¾‹ID
        updateProcessInstanceId(formId, dataId, instance.getId());
        
        // 5. å¦‚æœå¯ç”¨ç‰ˆæœ¬æ§åˆ¶ï¼Œä¿å­˜åˆå§‹å¿«ç…§
        if (config.isVersionControlEnabled()) {
            saveFormSnapshot(instance.getId(), "start", formData);
        }
        
        return instance.getId();
    }
    
    /**
     * æäº¤èŠ‚ç‚¹è¡¨å•æ•°æ®
     */
    @Transactional
    public void submitNodeForm(String taskId, String nodeCode, Map<String, Object> formData) {
        
        Task task = taskService.createTaskQuery().taskId(taskId).singleResult();
        String processInstanceId = task.getProcessInstanceId();
        
        // 1. è·å–é…ç½®
        OnlCgformWorkflowConfig config = getWorkflowConfigByProcessInstance(processInstanceId);
        
        // 2. æƒé™éªŒè¯
        if (config.isPermissionControlEnabled()) {
            validateNodePermissions(config.getCgformHeadId(), nodeCode, formData);
        }
        
        // 3. æ›´æ–°ä¸šåŠ¡è¡¨
        String dataId = getBusinessDataId(processInstanceId);
        updateBusinessData(config.getCgformHeadId(), dataId, formData);
        
        // 4. ä¿å­˜ç‰ˆæœ¬å¿«ç…§
        if (config.isVersionControlEnabled()) {
            saveFormSnapshot(processInstanceId, nodeCode, formData);
        }
        
        // 5. å®Œæˆä»»åŠ¡
        taskService.complete(taskId, formData);
        
        // 6. æ›´æ–°ä¸šåŠ¡çŠ¶æ€
        updateBusinessStatusFromProcess(processInstanceId);
    }
    
    /**
     * è·å–èŠ‚ç‚¹è¡¨å•é…ç½®
     */
    public NodeFormConfig getNodeFormConfig(String formId, String nodeId, String processInstanceId) {
        
        // 1. è·å–åŸºç¡€è¡¨å•é…ç½®
        OnlineFormConfig baseConfig = getBaseFormConfig(formId);
        
        // 2. è·å–èŠ‚ç‚¹æƒé™é…ç½®
        FormPermissionConfig permissionConfig = permissionEngine
            .getNodePermission(formId, nodeId);
        
        // 3. åº”ç”¨æƒé™åˆ°è¡¨å•
        applyPermissionToForm(baseConfig, permissionConfig);
        
        // 4. å¡«å……å·²æœ‰æ•°æ®
        if (processInstanceId != null) {
            fillExistingData(baseConfig, processInstanceId);
        }
        
        return new NodeFormConfig(baseConfig, permissionConfig);
    }
}
```

### 3.2 å¢å¼ºæƒé™æ§åˆ¶å¼•æ“
```java
@Component
public class OnlineFormPermissionEngine {
    
    @Autowired
    private DefaultFieldPermissionStrategy defaultStrategy;
    
    @Autowired
    private OnlCgformWorkflowNodeMapper nodeConfigMapper;
    
    /**
     * è·å–èŠ‚ç‚¹æƒé™é…ç½®ï¼ˆæ”¯æŒæ™ºèƒ½é»˜è®¤å’Œæ˜¾å¼é…ç½®ï¼‰
     */
    public FormPermissionConfig getNodePermission(String formId, String processDefinitionKey, String nodeId) {
        
        // 1. ä¼˜å…ˆæŸ¥è¯¢æ˜¾å¼é…ç½®ï¼ˆæ¥è‡ªFlowableè®¾è®¡å™¨ï¼‰
        OnlCgformWorkflowNode nodeConfig = nodeConfigMapper.selectOne(
            Wrappers.<OnlCgformWorkflowNode>lambdaQuery()
                .eq(OnlCgformWorkflowNode::getCgformHeadId, formId)
                .eq(OnlCgformWorkflowNode::getProcessDefinitionKey, processDefinitionKey)
                .eq(OnlCgformWorkflowNode::getNodeId, nodeId)
        );
        
        if (nodeConfig != null) {
            return parseExplicitConfig(nodeConfig);
        }
        
        // 2. ä½¿ç”¨æ™ºèƒ½é»˜è®¤ç­–ç•¥
        log.debug("èŠ‚ç‚¹ {} æœªæ‰¾åˆ°æ˜¾å¼æƒé™é…ç½®ï¼Œä½¿ç”¨æ™ºèƒ½é»˜è®¤ç­–ç•¥", nodeId);
        return defaultStrategy.generateDefaultPermission(formId, nodeId);
    }
    
    /**
     * è§£ææ˜¾å¼é…ç½®
     */
    private FormPermissionConfig parseExplicitConfig(OnlCgformWorkflowNode nodeConfig) {
        FormPermissionConfig config = new FormPermissionConfig();
        
        // è§£æJSONé…ç½®
        if (StringUtils.isNotBlank(nodeConfig.getEditableFields())) {
            config.setEditableFields(JSON.parseArray(nodeConfig.getEditableFields(), String.class));
        }
        if (StringUtils.isNotBlank(nodeConfig.getReadonlyFields())) {
            config.setReadonlyFields(JSON.parseArray(nodeConfig.getReadonlyFields(), String.class));
        }
        if (StringUtils.isNotBlank(nodeConfig.getHiddenFields())) {
            config.setHiddenFields(JSON.parseArray(nodeConfig.getHiddenFields(), String.class));
        }
        if (StringUtils.isNotBlank(nodeConfig.getRequiredFields())) {
            config.setRequiredFields(JSON.parseArray(nodeConfig.getRequiredFields(), String.class));
        }
        
        // è®¾ç½®è¡¨å•æ¨¡å¼
        config.setFormMode(nodeConfig.getFormMode());
        
        log.debug("å·²åŠ è½½èŠ‚ç‚¹ {} çš„æ˜¾å¼æƒé™é…ç½®ï¼šå¯ç¼–è¾‘={}, åªè¯»={}, éšè—={}", 
                 nodeConfig.getNodeId(), 
                 config.getEditableFields().size(),
                 config.getReadonlyFields().size(),
                 config.getHiddenFields().size());
        
        return config;
    }
    
    /**
     * åº”ç”¨æƒé™åˆ°è¡¨å•é…ç½®
     */
    public void applyPermissionToForm(OnlineFormConfig formConfig, FormPermissionConfig permission) {
        
        log.debug("å¼€å§‹åº”ç”¨å­—æ®µæƒé™ï¼Œå…± {} ä¸ªå­—æ®µ", formConfig.getFields().size());
        
        formConfig.getFields().forEach(field -> {
            String fieldName = field.getFieldName();
            
            // åº”ç”¨ç¼–è¾‘æƒé™
            if (permission.getEditableFields().contains(fieldName)) {
                field.setReadonly(false);
                log.debug("å­—æ®µ {} è®¾ç½®ä¸ºå¯ç¼–è¾‘", fieldName);
            } else if (permission.getReadonlyFields().contains(fieldName)) {
                field.setReadonly(true);
                log.debug("å­—æ®µ {} è®¾ç½®ä¸ºåªè¯»", fieldName);
            }
            
            // åº”ç”¨æ˜¾ç¤ºæƒé™
            if (permission.getHiddenFields().contains(fieldName)) {
                field.setHidden(true);
                log.debug("å­—æ®µ {} è®¾ç½®ä¸ºéšè—", fieldName);
            }
            
            // åº”ç”¨å¿…å¡«æƒé™
            if (permission.getRequiredFields().contains(fieldName)) {
                field.setRequired(true);
                log.debug("å­—æ®µ {} è®¾ç½®ä¸ºå¿…å¡«", fieldName);
            }
        });
        
        // åº”ç”¨è¡¨å•æ¨¡å¼
        if (StringUtils.isNotBlank(permission.getFormMode())) {
            formConfig.setMode(permission.getFormMode());
        }
    }
    
    /**
     * éªŒè¯èŠ‚ç‚¹æƒé™ï¼ˆæäº¤æ—¶æ ¡éªŒï¼‰
     */
    public void validateNodePermissions(String formId, String processDefinitionKey, 
                                       String nodeId, Map<String, Object> formData) {
        
        FormPermissionConfig permission = getNodePermission(formId, processDefinitionKey, nodeId);
        
        // æ£€æŸ¥æ˜¯å¦æäº¤äº†åªè¯»å­—æ®µçš„ä¿®æ”¹
        for (String readonlyField : permission.getReadonlyFields()) {
            if (formData.containsKey(readonlyField)) {
                throw new BusinessException("å­—æ®µ " + readonlyField + " åœ¨å½“å‰èŠ‚ç‚¹ä¸ºåªè¯»ï¼Œä¸å…è®¸ä¿®æ”¹");
            }
        }
        
        // æ£€æŸ¥å¿…å¡«å­—æ®µ
        for (String requiredField : permission.getRequiredFields()) {
            Object value = formData.get(requiredField);
            if (value == null || StringUtils.isBlank(value.toString())) {
                throw new BusinessException("å­—æ®µ " + requiredField + " ä¸ºå¿…å¡«é¡¹ï¼Œè¯·å¡«å†™");
            }
        }
        
        log.debug("èŠ‚ç‚¹ {} æƒé™éªŒè¯é€šè¿‡", nodeId);
    }
}
```

## 4. ç•Œé¢è®¾è®¡æ–¹æ¡ˆ

### 4.1 è®¾è®¡ç†å¿µä¸ç”¨æˆ·ä½“éªŒ

#### 4.1.1 ä¸¤ç§æœ€ä½³ç•Œé¢è®¾è®¡æ¨¡å¼

**æ¨¡å¼1ï¼šè¡¨å•ä¸­å¿ƒæ¨¡å¼ï¼ˆâ­å¼ºçƒˆæ¨èï¼‰**
```
æ‰€æœ‰è§’è‰²ï¼šç»Ÿä¸€è¡¨å•URL â†’ æ™ºèƒ½æƒé™å±•ç¤º â†’ è§’è‰²ç›¸å…³æ“ä½œ
```
- âœ… **ä¿¡æ¯å®Œæ•´**ï¼šæ‰€æœ‰äººçœ‹åˆ°ç›¸åŒçš„ä¸šåŠ¡æ•°æ®ï¼Œç¡®ä¿ä¸Šä¸‹æ–‡å®Œæ•´æ€§
- âœ… **å¼€å‘æ•ˆç‡é«˜**ï¼šå¤ç”¨JeecgBootåœ¨çº¿è¡¨å•èƒ½åŠ›ï¼Œä¸€å¥—ä»£ç å¤šç§å±•ç¤º
- âœ… **ç”¨æˆ·ä½“éªŒä¼˜**ï¼šç•Œé¢ä¸€è‡´æ€§å¼ºï¼Œå­¦ä¹ æˆæœ¬ä½
- âœ… **ç»´æŠ¤æˆæœ¬ä½**ï¼šç»Ÿä¸€çš„æƒé™æ§åˆ¶å’Œæ•°æ®ç®¡ç†
- ğŸ¯ **é€‚ç”¨åœºæ™¯**ï¼š80%çš„é€šç”¨ä¸šåŠ¡æµç¨‹ï¼Œç®€å•åˆ°ä¸­ç­‰å¤æ‚åº¦çš„è¡¨å•

**æ¨¡å¼2ï¼šæ··åˆTabæ¨¡å¼ï¼ˆâœ…æ¨èï¼‰**
```
è¡¨å•è¯¦æƒ…é¡µ â†’ Tabåˆ‡æ¢ï¼ˆè¡¨å•æ•°æ® + æµç¨‹æ“ä½œ + å®¡æ‰¹å†å² + ç‰ˆæœ¬å¯¹æ¯”ï¼‰
```
- âœ… **ä¿¡æ¯ç»„ç»‡æ¸…æ™°**ï¼šé€šè¿‡Tabåˆ†ç»„ç®¡ç†ï¼Œå±‚æ¬¡åˆ†æ˜
- âœ… **é€‚åˆå¤æ‚åœºæ™¯**ï¼šä¿¡æ¯é‡å¤§ã€æ“ä½œå¤æ‚çš„å·¥ä½œæµè¡¨å•
- âœ… **åŠŸèƒ½å®Œæ•´**ï¼šæ”¯æŒç‰ˆæœ¬å¯¹æ¯”ã€é™„ä»¶ç®¡ç†ç­‰é«˜çº§åŠŸèƒ½
- âš ï¸ **ç•Œé¢ç›¸å¯¹å¤æ‚**ï¼šéœ€è¦æ›´å¤šçš„äº¤äº’è®¾è®¡è€ƒè™‘
- ğŸ¯ **é€‚ç”¨åœºæ™¯**ï¼šå¤æ‚ä¸šåŠ¡æµç¨‹ï¼Œå­—æ®µè¶…è¿‡20ä¸ªæˆ–éœ€è¦é«˜çº§åŠŸèƒ½

#### 4.1.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **åŒä¸€URLï¼Œæ™ºèƒ½å±•ç¤º**ï¼šæ‰€æœ‰è§’è‰²è®¿é—®ç›¸åŒçš„è¡¨å•URLï¼Œç³»ç»Ÿæ ¹æ®ç”¨æˆ·è§’è‰²å’Œæµç¨‹çŠ¶æ€æ™ºèƒ½å±•ç¤º
2. **æ¸è¿›å¼ä¿¡æ¯å±•ç¤º**ï¼šæ ¹æ®æµç¨‹é˜¶æ®µè°ƒæ•´ç•Œé¢å¸ƒå±€å’Œä¿¡æ¯å¯†åº¦
3. **ä¸Šä¸‹æ–‡å®Œæ•´æ€§**ï¼šç¡®ä¿å®¡æ ¸äººå‘˜èƒ½çœ‹åˆ°å®Œæ•´çš„ç”³è¯·ä¿¡æ¯
4. **æ“ä½œä¾¿æ·æ€§**ï¼šå½“å‰èŠ‚ç‚¹çš„æ“ä½œçªå‡ºæ˜¾ç¤ºï¼Œå†å²ä¿¡æ¯æ”¶èµ·å±•ç¤º

#### 4.1.3 ç”¨æˆ·ä½“éªŒæµç¨‹è®¾è®¡

**ğŸ‘¤ ç”³è¯·äººè§†è§’**
```mermaid
flowchart TD
    A[è®¿é—®è¡¨å•URL] â†’ B[å¡«å†™ç”³è¯·è¡¨å•]
    B â†’ C[æäº¤ç”³è¯·]
    C â†’ D[æŸ¥çœ‹è¿›åº¦]
    D â†’ E[æµç¨‹å®Œæˆ]
    
    B1[å¯ç¼–è¾‘æ‰€æœ‰ç”³è¯·å­—æ®µ]
    C1[æ˜¾ç¤ºæäº¤æŒ‰é’®]
    D1[åªè¯»æ¨¡å¼ + æµç¨‹è¿›åº¦]
    E1[å®Œæ•´å†å²æŸ¥çœ‹]
    
    A -.-> B1
    B -.-> C1
    C -.-> D1
    D -.-> E1
```

**ğŸ‘¨â€ğŸ’¼ å®¡æ ¸äººè§†è§’ï¼ˆä»å¾…åŠè¿›å…¥ï¼‰**
```mermaid
flowchart TD
    A[å¾…åŠåˆ—è¡¨] â†’ B[ç‚¹å‡»å·¥å•]
    B â†’ C[è¡¨å•è¯¦æƒ…é¡µ]
    C â†’ D[å®¡æ ¸æ“ä½œ]
    D â†’ E[å®Œæˆå®¡æ ¸]
    
    A1[æ˜¾ç¤ºå·¥å•å¡ç‰‡æ‘˜è¦]
    C1[å®Œæ•´ç”³è¯·ä¿¡æ¯åªè¯» + å®¡æ ¸åŒºåŸŸå¯ç¼–è¾‘]
    D1[å®¡æ ¸æ„è§ + æ“ä½œæŒ‰é’®]
    E1[æµç¨‹æµè½¬]
    
    A -.-> A1
    B -.-> C1
    C -.-> D1
    D -.-> E1
```

### 4.2 è¡¨å•ä¸­å¿ƒæ™ºèƒ½ç•Œé¢ï¼ˆæ ¸å¿ƒæ–¹æ¡ˆï¼‰

**è®¾è®¡æ€è·¯ï¼šä¸€ä¸ªURLï¼Œæ™ºèƒ½å±•ç¤ºï¼Œæ‰€æœ‰è§’è‰²éƒ½èƒ½è·å¾—å®Œæ•´çš„ä¸šåŠ¡ä¸Šä¸‹æ–‡**

#### 4.2.1 ç•Œé¢å¸ƒå±€è®¾è®¡

```vue
<template>
  <div class="workflow-form-page">
    <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
    <div class="status-header">
      <a-steps :current="currentStepIndex" size="small" style="flex: 1">
        <a-step v-for="step in processSteps" :key="step.id" :title="step.name" />
      </a-steps>
      <div class="current-info">
        <a-tag :color="getStatusColor(currentStatus)">{{ currentStatusText }}</a-tag>
        <span>å½“å‰å¤„ç†äººï¼š{{ currentAssignee || 'ç³»ç»Ÿ' }}</span>
      </div>
    </div>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <a-row :gutter="24">
      <!-- å·¦ä¾§ï¼šè¡¨å•å†…å®¹ï¼ˆå ä¸»è¦ç©ºé—´ï¼‰ -->
      <a-col :span="18">
        <a-card title="å·¥å•è¯¦æƒ…" :bordered="false">
          <!-- åŠ¨æ€åœ¨çº¿è¡¨å• - æ ¹æ®è§’è‰²å’ŒèŠ‚ç‚¹æ™ºèƒ½å±•ç¤º -->
          <online-form 
            :form-id="formId"
            :data-id="dataId" 
            :mode="currentFormMode"
            :field-permissions="currentFieldPermissions"
            :readonly-fields="readonlyFields"
            :hidden-fields="hiddenFields"
            :required-fields="requiredFields"
            @submit="handleFormSubmit">
            
            <!-- å½“å‰èŠ‚ç‚¹æ“ä½œåŒºåŸŸ -->
            <template #actions>
              <div class="form-actions" v-if="hasCurrentTask">
                <!-- åŠ¨æ€æŒ‰é’®ç»„ -->
                <a-space size="large">
                  <a-button 
                    v-for="btn in currentNodeButtons" 
                    :key="btn.id"
                    :type="btn.type"
                    :loading="btn.loading"
                    @click="handleNodeAction(btn)">
                    {{ btn.text }}
                  </a-button>
                </a-space>
                
                <!-- å®¡æ ¸æ„è§åŒºåŸŸ -->
                <div v-if="needComment" class="comment-section">
                  <a-form-item label="å¤„ç†æ„è§" :required="commentRequired">
                    <a-textarea 
                      v-model:value="processComment"
                      placeholder="è¯·å¡«å†™å¤„ç†æ„è§..."
                      :rows="3" />
                  </a-form-item>
                </div>
              </div>
            </template>
          </online-form>
        </a-card>
      </a-col>
      
      <!-- å³ä¾§ï¼šæµç¨‹ä¿¡æ¯ä¾§æ  -->
      <a-col :span="6">
        <!-- å¿«é€Ÿæ“ä½œ -->
        <a-card title="å¿«é€Ÿæ“ä½œ" size="small" style="margin-bottom: 16px">
          <a-space direction="vertical" style="width: 100%">
            <a-button block @click="showProcessHistory">æŸ¥çœ‹æµç¨‹å†å²</a-button>
            <a-button block @click="showVersionHistory">æŸ¥çœ‹ç‰ˆæœ¬å†å²</a-button>
          </a-space>
        </a-card>
        
        <!-- æµç¨‹è¿›åº¦ -->
        <a-card title="æµç¨‹è¿›åº¦" size="small" style="margin-bottom: 16px">
          <process-timeline :process-instance-id="processInstanceId" :compact="true" />
        </a-card>
        
        <!-- å·¥å•ä¿¡æ¯ -->
        <a-card title="å·¥å•ä¿¡æ¯" size="small">
          <a-descriptions size="small" :column="1">
            <a-descriptions-item label="å·¥å•ç¼–å·">{{ reportNo }}</a-descriptions-item>
            <a-descriptions-item label="åˆ›å»ºæ—¶é—´">{{ createTime }}</a-descriptions-item>
            <a-descriptions-item label="ä¼˜å…ˆçº§">
              <priority-tag :level="urgencyLevel" />
            </a-descriptions-item>
            <a-descriptions-item label="æ‰€å±é¡¹ç›®">{{ projectName }}</a-descriptions-item>
          </a-descriptions>
        </a-card>
      </a-col>
    </a-row>
  </div>
</template>
```

#### 4.2.2 æ™ºèƒ½æ˜¾ç¤ºæ¨¡å¼è®¡ç®—

```java
@Service
public class FormDisplayModeService {
    
    public FormDisplayMode calculateDisplayMode(String formId, String dataId, String userId) {
        
        FormDisplayMode mode = new FormDisplayMode();
        
        // 1. è·å–åŸºç¡€ä¿¡æ¯
        UserInfo currentUser = userService.getUserInfo(userId);
        ProcessInstance processInfo = getProcessInstance(dataId);
        Task currentTask = getCurrentUserTask(processInfo.getId(), userId);
        
        if (currentTask != null) {
            // ç”¨æˆ·æœ‰å½“å‰ä»»åŠ¡ - æ“ä½œæ¨¡å¼
            mode.setMode(FormMode.OPERATE);
            mode.setHasCurrentTask(true);
            
            // è·å–èŠ‚ç‚¹æƒé™é…ç½®
            FormPermissionConfig permissions = permissionEngine.getNodePermission(
                formId, currentTask.getTaskDefinitionKey());
            mode.setFieldPermissions(permissions);
            
            // è·å–èŠ‚ç‚¹æŒ‰é’®é…ç½®  
            List<NodeButton> buttons = getNodeButtons(formId, currentTask.getTaskDefinitionKey());
            mode.setAvailableActions(buttons);
            
        } else if (processInfo != null && !processInfo.isEnded()) {
            // æµç¨‹è¿›è¡Œä¸­ä½†ç”¨æˆ·æ— ä»»åŠ¡ - è·Ÿè¸ªæ¨¡å¼
            mode.setMode(FormMode.TRACK);
            mode.setFieldPermissions(getTrackPermissions(formId, currentUser));
            
        } else {
            // æµç¨‹å·²ç»“æŸæˆ–æœªå¼€å§‹ - æŸ¥çœ‹æ¨¡å¼
            mode.setMode(FormMode.VIEW);
            mode.setFieldPermissions(getViewPermissions(formId, currentUser));
        }
        
        return mode;
    }
}
```

### 4.3 Tabç»„åˆæ¨¡å¼ï¼ˆé€‚åˆå¤æ‚åœºæ™¯ï¼‰

**é€‚ç”¨åœºæ™¯ï¼šä¿¡æ¯é‡å¤§ã€æ“ä½œå¤æ‚çš„å·¥ä½œæµè¡¨å•**

```vue
<template>
  <div class="workflow-form-container">
    <a-tabs v-model:activeKey="activeTab" type="card">
      
      <!-- ä¸»è¡¨å•Tab -->
      <a-tab-pane key="form" tab="è¡¨å•æ•°æ®" :forceRender="true">
        <online-form 
          :formId="formId" 
          :dataId="dataId"
          :taskId="currentTaskId"
          :nodePermissions="currentNodePermissions"
          @submit="handleFormSubmit" />
      </a-tab-pane>
      
      <!-- æµç¨‹æ“ä½œTab -->
      <a-tab-pane key="process" tab="æµç¨‹æ“ä½œ" v-if="hasCurrentTask">
        <div class="process-operation-panel">
          <a-card title="å½“å‰ä»»åŠ¡" size="small">
            <a-descriptions :column="2">
              <a-descriptions-item label="ä»»åŠ¡åç§°">{{ currentTaskName }}</a-descriptions-item>
              <a-descriptions-item label="å¤„ç†äºº">{{ currentAssignee }}</a-descriptions-item>
              <a-descriptions-item label="åˆ›å»ºæ—¶é—´">{{ currentTaskCreateTime }}</a-descriptions-item>
              <a-descriptions-item label="æˆªæ­¢æ—¶é—´">{{ currentTaskDueDate }}</a-descriptions-item>
            </a-descriptions>
          </a-card>
          
          <a-card title="å¤„ç†æ“ä½œ" size="small" style="margin-top: 16px">
            <a-form :model="processForm" layout="vertical">
              <a-form-item label="å¤„ç†æ„è§" required>
                <a-textarea v-model:value="processForm.comment" :rows="4" />
              </a-form-item>
              <a-form-item label="è½¬åŠç»™" v-if="allowTransfer">
                <a-select v-model:value="processForm.transferTo" placeholder="é€‰æ‹©è½¬åŠäººå‘˜">
                  <a-select-option v-for="user in availableUsers" :key="user.id" :value="user.id">
                    {{ user.name }}
                  </a-select-option>
                </a-select>
              </a-form-item>
            </a-form>
            
            <div class="action-buttons">
              <a-space>
                <a-button type="primary" @click="approveTask">åŒæ„</a-button>
                <a-button danger @click="rejectTask">æ‹’ç»</a-button>
                <a-button @click="transferTask" v-if="allowTransfer">è½¬åŠ</a-button>
              </a-space>
            </div>
          </a-card>
        </div>
      </a-tab-pane>
      
      <!-- æµç¨‹å†å²Tab -->
      <a-tab-pane key="history" tab="æµç¨‹å†å²">
        <workflow-progress 
          :processInstanceId="processInstanceId"
          :showComments="true"
          :showAttachments="true" />
      </a-tab-pane>
      
      <!-- ç‰ˆæœ¬å†å²Tab -->
      <a-tab-pane key="versions" tab="ç‰ˆæœ¬å†å²" v-if="versionControlEnabled">
        <form-version-timeline 
          :processInstanceId="processInstanceId"
          @compare="handleVersionCompare"
          @rollback="handleVersionRollback" />
      </a-tab-pane>
      
      <!-- ç›¸å…³é™„ä»¶Tab -->
      <a-tab-pane key="attachments" tab="ç›¸å…³é™„ä»¶">
        <process-attachments 
          :processInstanceId="processInstanceId"
          :currentTaskId="currentTaskId"
          :editable="hasCurrentTask" />
      </a-tab-pane>
      
    </a-tabs>
  </div>
</template>
```

### 4.4 ç»Ÿä¸€è·¯ç”±è®¾è®¡

#### 4.4.1 è·¯ç”±é…ç½®æ–¹æ¡ˆ

```javascript
// è·¯ç”±é…ç½®
{
  path: '/form/:formType/:dataId?',
  component: 'UniversalFormPage',
  meta: { 
    title: 'è¡¨å•è¯¦æƒ…',
    requiresAuth: true 
  }
}

// è®¿é—®ç¤ºä¾‹
// æ–°å»ºï¼š/form/maintenance-report
// æŸ¥çœ‹ï¼š/form/maintenance-report/123456  
// å¾…åŠï¼š/form/maintenance-report/123456?taskId=task001
```

#### 4.4.2 é¡µé¢åˆå§‹åŒ–é€»è¾‘

```javascript
export default {
  async created() {
    const { formType, dataId } = this.$route.params;
    const { taskId } = this.$route.query;
    
    if (!dataId) {
      // æ–°å»ºæ¨¡å¼
      this.initCreateMode(formType);
    } else {
      // æŸ¥çœ‹/ç¼–è¾‘æ¨¡å¼
      await this.initViewMode(formType, dataId, taskId);
    }
  },
  
  methods: {
    async initViewMode(formType, dataId, taskId) {
      // 1. è·å–è¡¨å•é…ç½®å’Œæ•°æ®
      const formConfig = await this.getFormConfig(formType);
      const formData = await this.getFormData(formType, dataId);
      
      // 2. è·å–æµç¨‹ä¿¡æ¯
      const processInfo = await this.getProcessInfo(dataId);
      
      // 3. åˆ¤æ–­æ˜¾ç¤ºæ¨¡å¼
      const displayMode = await this.calculateDisplayMode(formType, dataId, taskId);
      
      // 4. åº”ç”¨é…ç½®
      this.applyConfiguration(formConfig, formData, processInfo, displayMode);
    }
  }
}
```

### 4.5 ç•Œé¢è®¾è®¡æœ€ä½³å®è·µ

#### 4.5.1 å“åº”å¼è®¾è®¡åŸåˆ™

```scss
// ç§»åŠ¨ç«¯é€‚é…
@media (max-width: 768px) {
  .workflow-form-page {
    .a-row {
      flex-direction: column;
    }
    
    .a-col {
      width: 100% !important;
      margin-bottom: 16px;
    }
    
    .status-header {
      flex-direction: column;
      gap: 12px;
      
      .a-steps {
        order: 2;
      }
      
      .current-info {
        order: 1;
        justify-content: center;
      }
    }
  }
}
```

#### 4.5.2 ç”¨æˆ·ä½“éªŒä¼˜åŒ–

1. **æ¸è¿›å¼ä¿¡æ¯å±•ç¤º**
   - ç”³è¯·é˜¶æ®µï¼šä¸“æ³¨è¡¨å•å¡«å†™ï¼Œæœ€å°åŒ–å¹²æ‰°ä¿¡æ¯
   - å®¡æ ¸é˜¶æ®µï¼šçªå‡ºæ“ä½œæŒ‰é’®ï¼Œå†å²ä¿¡æ¯æ”¶èµ·å±•ç¤º
   - æŸ¥çœ‹é˜¶æ®µï¼šå®Œæ•´ä¿¡æ¯å±•ç¤ºï¼Œæ”¯æŒå¯¼å‡ºæ‰“å°

2. **æ“ä½œåé¦ˆ**
   - è¡¨å•éªŒè¯ï¼šå®æ—¶éªŒè¯æç¤º
   - æäº¤çŠ¶æ€ï¼šLoadingçŠ¶æ€å’Œè¿›åº¦æç¤º
   - æ“ä½œç»“æœï¼šæˆåŠŸ/å¤±è´¥æ¶ˆæ¯æç¤º

3. **é”®ç›˜å¿«æ·é”®æ”¯æŒ**
   ```javascript
   // å¿«æ·é”®é…ç½®
   mounted() {
     document.addEventListener('keydown', this.handleKeydown);
   },
   
   handleKeydown(e) {
     if (e.ctrlKey && e.key === 's') {
       e.preventDefault();
       this.saveForm(); // Ctrl+S ä¿å­˜
     }
     if (e.ctrlKey && e.key === 'Enter') {
       e.preventDefault();
       this.submitForm(); // Ctrl+Enter æäº¤
     }
   }
   ```

### 4.6 è®¾è®¡æ–¹æ¡ˆæ€»ç»“

#### 4.6.1 æ¨èæ–¹æ¡ˆå¯¹æ¯”

| è®¾è®¡æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | å¼€å‘å¤æ‚åº¦ | ç”¨æˆ·ä½“éªŒ | ç»´æŠ¤æˆæœ¬ | æ¨èæŒ‡æ•° |
|----------|----------|------------|----------|----------|----------|
| è¡¨å•ä¸­å¿ƒæ¨¡å¼ | é€šç”¨ä¸šåŠ¡æµç¨‹<br/>80%åœºæ™¯é€‚ç”¨ | â­â­ | â­â­â­â­â­ | â­â­ | â­â­â­â­â­ |
| æ··åˆTabæ¨¡å¼ | å¤æ‚ä¸šåŠ¡æµç¨‹<br/>é«˜çº§åŠŸèƒ½éœ€æ±‚ | â­â­â­ | â­â­â­â­ | â­â­â­ | â­â­â­â­ |

#### 4.6.2 å®æ–½å»ºè®®

1. **ä¼˜å…ˆæ¨èè¡¨å•ä¸­å¿ƒæ¨¡å¼**ï¼šå……åˆ†åˆ©ç”¨JeecgBootåœ¨çº¿è¡¨å•èƒ½åŠ›ï¼Œå¼€å‘æ•ˆç‡æœ€é«˜
2. **å¤æ‚åœºæ™¯ä½¿ç”¨Tabæ¨¡å¼**ï¼šå½“å•é¡µé¢ä¿¡æ¯è¿‡å¤šæ—¶ï¼Œé€šè¿‡Tabåˆ†ç»„ç®¡ç†
3. **æ¸è¿›å¼å®æ–½**ï¼šå…ˆå®ç°è¡¨å•ä¸­å¿ƒæ¨¡å¼ï¼Œåç»­æ ¹æ®éœ€è¦æ‰©å±•TabåŠŸèƒ½
4. **ä¿æŒä¸€è‡´æ€§**ï¼šæ•´ä¸ªç³»ç»Ÿé‡‡ç”¨ç»Ÿä¸€çš„ç•Œé¢è®¾è®¡è¯­è¨€

è¿™ç§è®¾è®¡æ–¹æ¡ˆå®Œç¾ç»“åˆäº†æ‚¨çš„æŠ€æœ¯æ¶æ„ï¼Œæ—¢ä¿æŒäº†ä¿¡æ¯çš„å®Œæ•´æ€§ï¼Œåˆæä¾›äº†ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒï¼

### 4.7 å¯è§†åŒ–æƒé™é…ç½®å™¨
```vue
<template>
  <div class="permission-config-designer">
    <a-row :gutter="16">
      
      <!-- å·¦ä¾§ï¼šæµç¨‹èŠ‚ç‚¹å›¾ -->
      <a-col :span="8">
        <a-card title="æµç¨‹èŠ‚ç‚¹" size="small">
          <div class="process-nodes">
            <div 
              v-for="node in processNodes" 
              :key="node.id"
              :class="['node-item', {active: selectedNode?.id === node.id}]"
              @click="selectNode(node)">
              <a-badge :count="getNodeFieldCount(node.id)" showZero>
                <div class="node-content">
                  <icon-node />
                  <span>{{ node.name }}</span>
                </div>
              </a-badge>
            </div>
          </div>
        </a-card>
      </a-col>
      
      <!-- å³ä¾§ï¼šå­—æ®µæƒé™é…ç½® -->
      <a-col :span="16">
        <a-card 
          :title="selectedNode ? `${selectedNode.name} - å­—æ®µæƒé™` : 'è¯·é€‰æ‹©èŠ‚ç‚¹'"
          size="small">
          
          <template v-if="selectedNode">
            <!-- å¿«é€Ÿæ“ä½œ -->
            <div class="quick-actions">
              <a-space>
                <a-button @click="setAllEditable">å…¨éƒ¨å¯ç¼–è¾‘</a-button>
                <a-button @click="setAllReadonly">å…¨éƒ¨åªè¯»</a-button>
                <a-button @click="resetPermissions">é‡ç½®æƒé™</a-button>
                <a-button type="primary" @click="savePermissions">ä¿å­˜é…ç½®</a-button>
              </a-space>
            </div>
            
            <!-- å­—æ®µæƒé™è¡¨æ ¼ -->
            <a-table 
              :columns="fieldColumns" 
              :dataSource="formFields"
              :pagination="false"
              size="small"
              style="margin-top: 16px">
              
              <template #bodyCell="{ column, record }">
                <template v-if="column.key === 'permission'">
                  <a-select 
                    v-model:value="record.permission" 
                    size="small"
                    @change="updateFieldPermission(record)">
                    <a-select-option value="editable">
                      <a-tag color="green">å¯ç¼–è¾‘</a-tag>
                    </a-select-option>
                    <a-select-option value="readonly">
                      <a-tag color="orange">åªè¯»</a-tag>
                    </a-select-option>
                    <a-select-option value="hidden">
                      <a-tag color="red">éšè—</a-tag>
                    </a-select-option>
                  </a-select>
                </template>
                
                <template v-if="column.key === 'required'">
                  <a-checkbox 
                    v-model:checked="record.required"
                    :disabled="record.permission === 'hidden'"
                    @change="updateFieldRequired(record)" />
                </template>
              </template>
            </a-table>
          </template>
          
          <a-empty v-else description="è¯·é€‰æ‹©å·¦ä¾§èŠ‚ç‚¹è¿›è¡Œé…ç½®" />
        </a-card>
      </a-col>
      
    </a-row>
  </div>
</template>
```

### 4.3 ç‰ˆæœ¬å†å²æ—¶é—´çº¿ç»„ä»¶
```vue
<template>
  <div class="version-history-timeline">
    <a-timeline>
      <a-timeline-item 
        v-for="(snapshot, index) in versionHistory" 
        :key="index"
        :color="getTimelineColor(snapshot.nodeCode)">
        
        <template #dot>
          <a-avatar :size="32" :style="getNodeAvatarStyle(snapshot.nodeCode)">
            {{ getNodeIcon(snapshot.nodeCode) }}
          </a-avatar>
        </template>
        
        <div class="timeline-content">
          <div class="timeline-header">
            <h4>{{ getNodeDisplayName(snapshot.nodeCode) }}</h4>
            <span class="timeline-time">{{ formatTime(snapshot.timestamp) }}</span>
          </div>
          
          <div class="timeline-meta">
            <a-space>
              <a-tag>{{ snapshot.operatorName }}</a-tag>
              <span v-if="snapshot.changedFields?.length">
                å˜æ›´äº† {{ snapshot.changedFields.length }} ä¸ªå­—æ®µ
              </span>
              <a-tag 
                v-for="field in snapshot.changedFields?.slice(0, 3)" 
                :key="field"
                size="small">
                {{ getFieldDisplayName(field) }}
              </a-tag>
              <span v-if="snapshot.changedFields?.length > 3">
                ...
              </span>
            </a-space>
          </div>
          
          <div class="timeline-actions">
            <a-space>
              <a-button size="small" type="link" @click="viewSnapshot(snapshot)">
                æŸ¥çœ‹è¯¦æƒ…
              </a-button>
              <a-button size="small" type="link" @click="compareWithCurrent(snapshot)">
                ä¸å½“å‰å¯¹æ¯”
              </a-button>
              <a-dropdown>
                <a-button size="small" type="link">
                  æ›´å¤š <icon-down />
                </a-button>
                <template #overlay>
                  <a-menu>
                    <a-menu-item @click="compareWithPrevious(snapshot, index)">
                      ä¸ä¸Šç‰ˆæœ¬å¯¹æ¯”
                    </a-menu-item>
                    <a-menu-item @click="exportSnapshot(snapshot)">
                      å¯¼å‡ºæ­¤ç‰ˆæœ¬
                    </a-menu-item>
                    <a-menu-item 
                      @click="rollbackToSnapshot(snapshot)"
                      :disabled="!canRollback(snapshot)">
                      å›æ»šåˆ°æ­¤ç‰ˆæœ¬
                    </a-menu-item>
                  </a-menu>
                </template>
              </a-dropdown>
            </a-space>
          </div>
        </div>
      </a-timeline-item>
    </a-timeline>
  </div>
</template>
```

## 5. å®æ–½è·¯å¾„ä¸æ—¶é—´è§„åˆ’

### 5.1 ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€é›†æˆï¼ˆ2-3å‘¨ï¼‰

#### ç›®æ ‡ï¼šå®ç°æœ€åŸºæœ¬çš„è¡¨å•å·¥ä½œæµé›†æˆ
```sql
-- æ ¸å¿ƒä»»åŠ¡
1. åˆ›å»ºé…ç½®è¡¨ï¼šonl_cgform_workflow_config, onl_cgform_workflow_node
2. æ‰©å±•ä¸šåŠ¡è¡¨ï¼šæ·»åŠ process_instance_id, bmp_statuså­—æ®µ
3. å®ç°åŸºç¡€æœåŠ¡ï¼šå¯åŠ¨æµç¨‹ã€æäº¤è¡¨å•ã€çŠ¶æ€åŒæ­¥
4. åŸºç¡€ç•Œé¢ï¼šè¡¨å•ä¸­å¿ƒæ¨¡å¼é¡µé¢
5. æ™ºèƒ½é»˜è®¤æƒé™ç­–ç•¥ï¼šDefaultFieldPermissionStrategy
```

#### éªŒæ”¶æ ‡å‡†
- âœ… è¡¨å•å¯ä»¥å¯åŠ¨å·¥ä½œæµ
- âœ… å·¥ä½œæµå®ŒæˆåçŠ¶æ€åŒæ­¥åˆ°ä¸šåŠ¡è¡¨
- âœ… åŸºç¡€çš„ä»»åŠ¡æäº¤åŠŸèƒ½æ­£å¸¸
- âœ… æ™ºèƒ½é»˜è®¤æƒé™ç­–ç•¥ç”Ÿæ•ˆï¼ˆå‘èµ·äººå¯ç¼–è¾‘ï¼Œå…¶ä»–åªè¯»ï¼‰

### 5.2 ç¬¬äºŒé˜¶æ®µï¼šFlowableè®¾è®¡å™¨æ‰©å±•ï¼ˆ3-4å‘¨ï¼‰

#### ç›®æ ‡ï¼šå®ç°ä¸€ä½“åŒ–æƒé™é…ç½®
```javascript
-- æ ¸å¿ƒä»»åŠ¡
1. æ‰©å±•Flowable Modelerï¼šå¢åŠ å­—æ®µæƒé™é…ç½®é¢æ¿
2. BPMNæ‰©å±•å±æ€§ï¼šå®šä¹‰jeecg:fieldPermissions
3. éƒ¨ç½²æ—¶è§£æï¼šBpmnFieldPermissionParser
4. æƒé™å¼•æ“å¢å¼ºï¼šæ”¯æŒæ˜¾å¼é…ç½®+æ™ºèƒ½é»˜è®¤
5. å‰ç«¯é…ç½®ç•Œé¢ï¼šå­—æ®µæƒé™è¡¨æ ¼+å¿«é€Ÿæ“ä½œ
```

#### éªŒæ”¶æ ‡å‡†
- âœ… æµç¨‹è®¾è®¡å™¨ä¸­å¯ä»¥é…ç½®å­—æ®µæƒé™
- âœ… æµç¨‹éƒ¨ç½²æ—¶è‡ªåŠ¨è§£æå¹¶åŒæ­¥æƒé™é…ç½®
- âœ… æ”¯æŒæ˜¾å¼é…ç½®å’Œæ™ºèƒ½é»˜è®¤çš„æ··åˆæ¨¡å¼
- âœ… é…ç½®ç•Œé¢å‹å¥½ï¼Œæ”¯æŒæ‰¹é‡æ“ä½œ

### 5.3 ç¬¬ä¸‰é˜¶æ®µï¼šç‰ˆæœ¬æ§åˆ¶ä¸é«˜çº§åŠŸèƒ½ï¼ˆ2-3å‘¨ï¼‰

#### ç›®æ ‡ï¼šåŸºäºFlowableå˜é‡çš„ç‰ˆæœ¬åŒ–
```java
// æ ¸å¿ƒä»»åŠ¡
1. å®ç°ç‰ˆæœ¬å¿«ç…§æœåŠ¡ï¼šFormSnapshotå­˜å‚¨åˆ°Flowableå˜é‡
2. ç‰ˆæœ¬æŸ¥è¯¢å’Œå¯¹æ¯”åŠŸèƒ½ï¼šæ”¯æŒèŠ‚ç‚¹é—´ç‰ˆæœ¬å¯¹æ¯”
3. ç‰ˆæœ¬å†å²æ—¶é—´çº¿ç•Œé¢ï¼šå¯è§†åŒ–ç‰ˆæœ¬æ¼”å˜è¿‡ç¨‹
4. æ··åˆTabæ¨¡å¼ï¼šæ”¯æŒå¤æ‚ä¸šåŠ¡åœºæ™¯
5. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼šå¤§è¡¨å•å‹ç¼©å­˜å‚¨ã€åˆ†åŒºä¼˜åŒ–å‡†å¤‡
```

#### éªŒæ”¶æ ‡å‡†
- âœ… æ¯ä¸ªèŠ‚ç‚¹è‡ªåŠ¨ä¿å­˜è¡¨å•å¿«ç…§åˆ°Flowableå˜é‡
- âœ… å¯ä»¥æŸ¥çœ‹å®Œæ•´ç‰ˆæœ¬å†å²æ—¶é—´çº¿
- âœ… æ”¯æŒç‰ˆæœ¬å¯¹æ¯”åŠŸèƒ½ï¼Œæ˜¾ç¤ºå­—æ®µå˜æ›´
- âœ… æ··åˆTabæ¨¡å¼é€‚é…å¤æ‚è¡¨å•åœºæ™¯
- âœ… æ€§èƒ½åŸºå‡†æµ‹è¯•é€šè¿‡ï¼ˆæ”¯æŒä¸­ç­‰æ•°æ®é‡ï¼‰

### 5.4 ç¬¬å››é˜¶æ®µï¼šç”Ÿäº§ä¼˜åŒ–ä¸æ–‡æ¡£å®Œå–„ï¼ˆ1-2å‘¨ï¼‰

#### ç›®æ ‡ï¼šç”Ÿäº§å°±ç»ªä¸ç”¨æˆ·åŸ¹è®­
```javascript
// æ ¸å¿ƒä»»åŠ¡
1. æ€§èƒ½ä¼˜åŒ–ï¼šç¼“å­˜ç­–ç•¥ã€å¼‚æ­¥å¤„ç†ã€æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
2. ç›‘æ§å‘Šè­¦ï¼šæ•°æ®ä¸€è‡´æ€§æ£€æŸ¥ã€å¼‚å¸¸ç›‘æ§
3. ç”¨æˆ·æ–‡æ¡£ï¼šé…ç½®æ‰‹å†Œã€æœ€ä½³å®è·µæŒ‡å—
4. å¼€å‘æ–‡æ¡£ï¼šAPIæ–‡æ¡£ã€æ‰©å±•æŒ‡å—
5. åŸ¹è®­ææ–™ï¼šæ“ä½œè§†é¢‘ã€FAQæ•´ç†
```

#### éªŒæ”¶æ ‡å‡†
- âœ… ç”Ÿäº§ç¯å¢ƒæ€§èƒ½æµ‹è¯•é€šè¿‡
- âœ… ç›‘æ§å‘Šè­¦ç³»ç»Ÿæ­£å¸¸è¿è¡Œ
- âœ… ç”¨æˆ·åŸ¹è®­æ–‡æ¡£å®Œæ•´
- âœ… å¼€å‘å›¢é˜ŸæŒæ¡ç»´æŠ¤æ–¹æ³•

## 6. é£é™©è¯„ä¼°ä¸åº”å¯¹

### 6.1 æŠ€æœ¯é£é™©
| é£é™©é¡¹ | é£é™©çº§åˆ« | åº”å¯¹æªæ–½ | ç¼“è§£æ•ˆæœ |
|--------|----------|----------|----------|
| Flowable Modeleræ‰©å±•å¤æ‚åº¦ | ä¸­ | åˆ†é˜¶æ®µå®æ–½ï¼Œå…ˆæ™ºèƒ½é»˜è®¤åæ˜¾å¼é…ç½® | é«˜ |
| ç‰ˆæœ¬å¿«ç…§å­˜å‚¨æ€§èƒ½ | ä¸­ | Flowableå˜é‡+å‹ç¼©å­˜å‚¨ï¼Œæœªæ¥å¯åˆ†åŒºä¼˜åŒ– | ä¸­ |
| æƒé™é…ç½®å­¦ä¹ æˆæœ¬ | ä½ | æ™ºèƒ½é»˜è®¤+å¯è§†åŒ–é…ç½®ç•Œé¢ | é«˜ |
| æ•°æ®ä¸€è‡´æ€§é—®é¢˜ | ä½ | äº‹åŠ¡æ§åˆ¶+å®šæœŸæ£€æŸ¥+ç›‘æ§å‘Šè­¦ | é«˜ |
| æµè§ˆå™¨å…¼å®¹æ€§ | ä½ | åŸºäºVue3+Ant Design Vueï¼Œå…¼å®¹æ€§è‰¯å¥½ | é«˜ |

### 6.2 ä¸šåŠ¡é£é™©  
| é£é™©é¡¹ | é£é™©çº§åˆ« | åº”å¯¹æªæ–½ | ç¼“è§£æ•ˆæœ |
|--------|----------|----------|----------|
| ç”¨æˆ·æ¥å—åº¦ | ä¸­ | æ™ºèƒ½é»˜è®¤+æ¸è¿›å¼åŸ¹è®­+æ“ä½œè§†é¢‘ | é«˜ |
| æµç¨‹è®¾è®¡å¸ˆå­¦ä¹ æˆæœ¬ | ä¸­ | å¯é€‰é…ç½®+è¯¦ç»†æ–‡æ¡£+æœ€ä½³å®è·µ | ä¸­ |
| ç°æœ‰ä¸šåŠ¡å½±å“ | ä½ | å‘ä¸‹å…¼å®¹+å¹³æ»‘è¿ç§» | é«˜ |
| ç»´æŠ¤æˆæœ¬å¢åŠ  | ä½ | æ ‡å‡†åŒ–é…ç½®+å®Œå–„ç›‘æ§ | é«˜ |

### 6.3 æ€§èƒ½é£é™©
| é£é™©é¡¹ | é£é™©çº§åˆ« | åº”å¯¹æªæ–½ | ç¼“è§£æ•ˆæœ |
|--------|----------|----------|----------|
| å¤§è¡¨å•å¿«ç…§å­˜å‚¨ | ä¸­ | å‹ç¼©ç®—æ³•+å¼‚æ­¥å­˜å‚¨+å®šæœŸæ¸…ç† | ä¸­ |
| æƒé™è®¡ç®—å¼€é”€ | ä½ | ç¼“å­˜ç­–ç•¥+æ‡’åŠ è½½ | é«˜ |
| æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½ | ä½ | ç´¢å¼•ä¼˜åŒ–+æŸ¥è¯¢ä¼˜åŒ– | é«˜ |
| å‰ç«¯æ¸²æŸ“æ€§èƒ½ | ä½ | è™šæ‹Ÿæ»šåŠ¨+åˆ†é¡µåŠ è½½ | é«˜ |

## 7. æ€»ç»“

### 7.1 æ ¸å¿ƒä»·å€¼
1. **ç®€å•ä¼˜å…ˆ**ï¼šåŸºäºæˆç†ŸæŠ€æœ¯æ ˆï¼Œæ™ºèƒ½é»˜è®¤ç­–ç•¥ï¼Œé™ä½å­¦ä¹ æˆæœ¬
2. **ä¸€ä½“åŒ–é…ç½®**ï¼šæµç¨‹è®¾è®¡+æƒé™é…ç½®ä¸€æ¬¡å®Œæˆï¼Œæå‡å¼€å‘æ•ˆç‡60%
3. **åŠŸèƒ½å®Œæ•´**ï¼šç‰ˆæœ¬æ§åˆ¶ã€æƒé™ç®¡ç†ã€æµç¨‹é›†æˆã€æ™ºèƒ½å±•ç¤ºä¸€ä½“åŒ–
4. **æ¸è¿›å®æ–½**ï¼šåˆ†é˜¶æ®µå®æ–½ï¼Œå…ˆç®€å•åå¤æ‚ï¼Œé£é™©å¯æ§
5. **æ€§èƒ½å‹å¥½**ï¼šFlowableå˜é‡å­˜å‚¨+æœªæ¥ä¼˜åŒ–è·¯å¾„æ¸…æ™°

### 7.2 åˆ›æ–°ç‚¹
1. **Flowableè®¾è®¡å™¨é›†æˆæƒé™é…ç½®**ï¼šä¸šç•Œé¦–åˆ›çš„ä¸€ä½“åŒ–é…ç½®æ–¹æ¡ˆ
2. **æ™ºèƒ½é»˜è®¤æƒé™ç­–ç•¥**ï¼šæ— é…ç½®å³å¯ç”¨ï¼Œé€šç”¨å­—æ®µè‡ªåŠ¨è¯†åˆ«
3. **Flowableå˜é‡ç‰ˆæœ¬åŒ–**ï¼šæ— éœ€é¢å¤–è¡¨ï¼Œè´´åˆå·¥ä½œæµç”Ÿå‘½å‘¨æœŸ
4. **è¡¨å•ä¸­å¿ƒæ™ºèƒ½ç•Œé¢**ï¼šä¸€ä¸ªURLï¼Œè§’è‰²è‡ªé€‚åº”ï¼Œä¿¡æ¯å®Œæ•´æ€§ä¿è¯
5. **åˆ†ç¦»å¼é›†æˆæ¶æ„**ï¼šä¿æŒè¡¨å•å’Œå·¥ä½œæµç‹¬ç«‹æ€§ï¼Œå¯æ‰©å±•æ€§å¼º

### 7.3 æŠ€æœ¯äº®ç‚¹
- ğŸš€ **å¼€å‘æ•ˆç‡**ï¼šå¤ç”¨JeecgBootåœ¨çº¿è¡¨å•èƒ½åŠ›ï¼Œä»£ç å¤ç”¨ç‡90%
- ğŸ¯ **ç”¨æˆ·ä½“éªŒ**ï¼šç»Ÿä¸€URLæ™ºèƒ½å±•ç¤ºï¼Œå­¦ä¹ æˆæœ¬ä½
- âš¡ **æ€§èƒ½ä¼˜åŒ–**ï¼šåˆ†å±‚ç¼“å­˜+å¼‚æ­¥å¤„ç†+ç´¢å¼•ä¼˜åŒ–
- ğŸ”§ **ç»´æŠ¤æ€§**ï¼šæ ‡å‡†åŒ–é…ç½®+å®Œå–„ç›‘æ§+è¯¦ç»†æ–‡æ¡£
- ğŸ“ˆ **æ‰©å±•æ€§**ï¼šæ”¯æŒå¤æ‚ä¸šåŠ¡åœºæ™¯ï¼Œæœªæ¥åŠŸèƒ½æ‰©å±•å‹å¥½

### 7.4 é€‚ç”¨åœºæ™¯
- âœ… **é€šç”¨å®¡æ‰¹æµç¨‹**ï¼šç»´ä¿å·¥å•ã€è¯·å‡ç”³è¯·ã€è´¹ç”¨æŠ¥é”€ç­‰
- âœ… **å¤æ‚ä¸šåŠ¡æµç¨‹**ï¼šåˆåŒå®¡æ‰¹ã€é¡¹ç›®ç®¡ç†ã€è´¨é‡æ£€æŸ¥ç­‰  
- âœ… **ç‰ˆæœ¬ç®¡ç†éœ€æ±‚**ï¼šé‡è¦ä¸šåŠ¡æ•°æ®çš„å˜æ›´è¿½æº¯
- âœ… **çµæ´»æƒé™æ§åˆ¶**ï¼šä¸åŒèŠ‚ç‚¹ä¸åŒå­—æ®µæƒé™çš„ç²¾ç»†åŒ–ç®¡ç†
- âœ… **å¿«é€Ÿå¼€å‘é¡¹ç›®**ï¼šä½ä»£ç å¹³å°çš„å·¥ä½œæµé›†æˆåœºæ™¯

### 7.5 å®æ–½æ•ˆæœé¢„æœŸ
- ğŸ“Š **å¼€å‘æ•ˆç‡æå‡60%**ï¼šä¸€ä½“åŒ–é…ç½®+æ™ºèƒ½é»˜è®¤
- ğŸ¯ **ç”¨æˆ·æ»¡æ„åº¦æå‡80%**ï¼šç•Œé¢ä¸€è‡´+æ“ä½œç®€å•
- ğŸ’° **ç»´æŠ¤æˆæœ¬é™ä½50%**ï¼šæ ‡å‡†åŒ–æ¶æ„+è‡ªåŠ¨åŒ–é…ç½®
- âš¡ **ä¸Šçº¿é€Ÿåº¦æå‡3å€**ï¼šåŸºäºæˆç†Ÿç»„ä»¶+æ¸è¿›å®æ–½

**è¿™æ˜¯ä¸€ä¸ªç»è¿‡æ·±åº¦æ€è€ƒã€æŠ€æœ¯å…ˆè¿›ã€ä¸šåŠ¡å®ç”¨çš„å®Œæ•´è§£å†³æ–¹æ¡ˆï¼ç»“åˆäº†JeecgBootçš„ä½ä»£ç ä¼˜åŠ¿å’ŒFlowableçš„å·¥ä½œæµèƒ½åŠ›ï¼Œå®ç°äº†çœŸæ­£çš„ä¸€ä½“åŒ–è¡¨å•å·¥ä½œæµå¹³å°ã€‚**

---

**æ–‡æ¡£ç‰ˆæœ¬**: v3.0 (Flowableè®¾è®¡å™¨é›†æˆç‰ˆ)  
**åˆ›å»ºæ—¶é—´**: 2024-12-25  
**æ›´æ–°æ—¶é—´**: 2024-12-25  
**ç»´æŠ¤å›¢é˜Ÿ**: JeecgBootå·¥ä½œæµé›†æˆé¡¹ç›®ç»„

## 8. é™„å½•

### 8.1 å…³é”®é…ç½®ç¤ºä¾‹

#### PostgreSQLç‰ˆæœ¬çš„æ•°æ®åº“è¡¨ç»“æ„
```sql
-- å·²åœ¨å‰é¢ç« èŠ‚æä¾›PostgreSQLç‰ˆæœ¬çš„å»ºè¡¨è¯­å¥
-- åŒ…å«è§¦å‘å™¨ã€æ³¨é‡Šã€ç´¢å¼•ç­‰å®Œæ•´é…ç½®
```

#### Flowableé…ç½®ç¡®è®¤
```yaml
# å·²ç¡®è®¤JeecgBooté¡¹ç›®æ”¯æŒPostgreSQL
# Flowableè¡¨ä¼šåœ¨å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»º
# é…ç½®æ–‡ä»¶ï¼šapplication-dev.yml
```

### 8.2 æœ€ä½³å®è·µå»ºè®®

1. **æƒé™é…ç½®åŸåˆ™**
   - ä¸šåŠ¡å­—æ®µï¼šå‘èµ·äººå¯ç¼–è¾‘ï¼Œå…¶ä»–èŠ‚ç‚¹åªè¯»
   - é€šç”¨å­—æ®µï¼šå„èŠ‚ç‚¹æ ¹æ®éœ€è¦å¯ç¼–è¾‘ï¼ˆå®¡æ‰¹æ„è§ç­‰ï¼‰
   - æ•æ„Ÿå­—æ®µï¼šæŒ‰éœ€éšè—æˆ–é™åˆ¶æƒé™

2. **æ€§èƒ½ä¼˜åŒ–å»ºè®®**  
   - å¤§è¡¨å•å¯ç”¨å¿«ç…§å‹ç¼©
   - å®šæœŸæ¸…ç†å†å²ç‰ˆæœ¬æ•°æ®
   - åˆç†è®¾ç½®ç¼“å­˜ç­–ç•¥

3. **ç”¨æˆ·åŸ¹è®­è¦ç‚¹**
   - æµç¨‹è®¾è®¡å¸ˆï¼šé‡ç‚¹åŸ¹è®­æƒé™é…ç½®åŠŸèƒ½
   - ä¸šåŠ¡ç”¨æˆ·ï¼šé‡ç‚¹åŸ¹è®­è¡¨å•æ“ä½œå’Œæµç¨‹æŸ¥çœ‹
   - ç®¡ç†å‘˜ï¼šé‡ç‚¹åŸ¹è®­ç›‘æ§å’Œç»´æŠ¤